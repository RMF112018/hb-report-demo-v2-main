---
description: 
globs: 
alwaysApply: false
---

# ðŸ§­ Guided Tour Ruleset for HB Report

## I. ðŸ“¦ Implementation Guidelines

### 1. Tour Component Structure
- Define all steps in `data/tours/tour-definitions.ts`
- Anchor steps to stable DOM nodes with `data-tour-id` or `id`
- Use unique selectors only

### 2. UI Requirements
- Components in tours must include:
  - Stable selectors
  - Proper z-index for visibility

### 3. Popover Positioning Rules
- Must not overflow viewport
- Use fallback logic from `useTourPositioning.ts`
- If no space available, switch to `centered-modal` fallback
- Step definition supports `positionFallback`

### 4. Auto-start Behavior
- Delay must:
  - Wait for full render (`DOMContentLoaded`, idle)
  - Wait 300ms idle timeout
  - Cancel if user scrolls/clicks before start
- Use `requestIdleCallback()` with user activity listener
- Avoid interrupting critical workflows

---

## II. âž• Extending the Tour

### 1. Adding to New Pages
- Add steps to `tour-definitions.ts`
- Register in `TakeTourButton.tsx` if user-triggered
- Wrap page with `<Tour>` component

### 2. Step Pattern
- Begin with intro step
- End with confirmation
- Limit to 5â€“8 steps
- Buttons: `Next`, `Back`, `Done`

---

## III. ðŸ“˜ Documentation Standards

### 1. README
- Keep `TOUR_ENHANCEMENTS.md` up to date
- Include architecture, authoring, known issues

### 2. Code Comments
- Top-level summary in:
  - `useTourPositioning.ts`
  - `tour-utils.ts`
  - `tour-context.tsx`
- Inline comments for all position/timing logic

---

## IV. ðŸ§¬ Git & PR Process

### 1. Branching
- Use `feature/tour-*` or `bugfix/tour-*`

### 2. PR Requirements
- Include tour demo video/gif
- Browser/screen size verification
- Note z-index/scroll handling

### 3. Testing
- Validate selectors in `tour.test.tsx`
- Confirm steps match rendered DOM

---

## V. ðŸ§ª Known Issues (to fix)

### 1. Step 3 Popover Overflow
- Patch `useTourPositioning.ts`
- Prevent bottom overflow with `getBoundingClientRect`

### 2. Auto-start Delay
- Use `requestIdleCallback()` with timeout cap
- Cancel if user becomes active before launch

---
